"use strict";(self.webpackChunk_1j1s_front_docs=self.webpackChunk_1j1s_front_docs||[]).push([[253],{3301:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var t=n(4848),r=n(8453);const i={},c="Mocker les m\xe9thodes des interfaces par spyOn",o={id:"adr/2023-06-06.mocker-les-methodes-des-interfaces-par-spyon",title:"Mocker les m\xe9thodes des interfaces par spyOn",description:"06 juin 2023",source:"@site/docs/adr/2023-06-06.mocker-les-methodes-des-interfaces-par-spyon.md",sourceDirName:"adr",slug:"/adr/2023-06-06.mocker-les-methodes-des-interfaces-par-spyon",permalink:"/1j1s-front/docs/adr/2023-06-06.mocker-les-methodes-des-interfaces-par-spyon",draft:!1,unlisted:!1,editUrl:"https://github.com/DNUM-SocialGouv/1j1s-front/tree/main/docs/docs/docs/adr/2023-06-06.mocker-les-methodes-des-interfaces-par-spyon.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Ne pas utiliser as unknown as MyClass",permalink:"/1j1s-front/docs/adr/2023-05-23.ne-pas-utiliser-as-unknown-as-myclass"},next:{title:"Storybook : Args dans la story",permalink:"/1j1s-front/docs/adr/2023-06-06.storybook-args-dans-la-story"}},l={},d=[{value:"TL;DR",id:"tldr",level:2},{value:"Contributeurs",id:"contributeurs",level:2},{value:"Statut",id:"statut",level:2},{value:"Contexte",id:"contexte",level:2},{value:"D\xe9cision",id:"d\xe9cision",level:2},{value:"Cons\xe9quences",id:"cons\xe9quences",level:2},{value:"Autres pistes explor\xe9es",id:"autres-pistes-explor\xe9es",level:2}];function a(e){const s={code:"code",em:"em",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"mocker-les-m\xe9thodes-des-interfaces-par-spyon",children:"Mocker les m\xe9thodes des interfaces par spyOn"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.em,{children:"06 juin 2023"})}),"\n",(0,t.jsx)(s.h2,{id:"tldr",children:"TL;DR"}),"\n",(0,t.jsxs)(s.p,{children:["Mocker les m\xe9thodes des interfaces par spyOn (exemple : ",(0,t.jsx)(s.code,{children:"jest.spyOn(httpClientService, 'get').mockResolvedValue(...)"}),")"]}),"\n",(0,t.jsx)(s.h2,{id:"contributeurs",children:"Contributeurs"}),"\n",(0,t.jsx)(s.p,{children:"Suxue Li, Julie Brunetto, Guillaume Moizan, Gauthier Fiorentino, Dorian De Rosa, Fred Nobre"}),"\n",(0,t.jsx)(s.h2,{id:"statut",children:"Statut"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.em,{children:"Accept\xe9"})}),"\n",(0,t.jsx)(s.h2,{id:"contexte",children:"Contexte"}),"\n",(0,t.jsxs)(s.p,{children:["Plusieurs mani\xe8res de mocker / stubber une d\xe9pendance, exemple avec la m\xe9thode ",(0,t.jsx)(s.code,{children:"get"})," sur le ",(0,t.jsx)(s.code,{children:"httpClientService"})," :"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"(httpClientService.get as jest.Mock).mockResolvedValue(...)"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"jest.spyOn(httpClientService, 'get').mockResolvedValue(...)"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"anHttpClientService({ get: jest.fn(async () => ({...}) })"})}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Apr\xe8s discussion, l'\xe9quipe s'accorde sur :"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"(httpClientService.get as jest.Mock).mockResolvedValue(...)"})," -> Ne plus le faire car plus besoin de red\xe9finir manuellement le type"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["L'\xe9quipe est divis\xe9e entre le ",(0,t.jsx)(s.code,{children:"jest.spyOn"})," et l'override \xe0 l'instanciation de la classe, pour des raisons de pr\xe9f\xe9rences subjectives de lecture."]}),"\n",(0,t.jsxs)(s.p,{children:["En utilisation, la m\xe9thode l'override \xe0 l'instanciation de la classe (",(0,t.jsx)(s.code,{children:"anHttpClientService({ get: jest.fn(async () => ({...}) })"}),") pr\xe9sente un d\xe9faut : lorsqu'on veut mocker la m\xeame m\xe9thode pour plusieurs appels, par exemple deux appels, on est oblig\xe9 d'\xe9crire :"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"const errorManagementService = anErrorManagementService({\n  handleFailureError: jest.fn(() => createFailure(ErreurM\xe9tier.SERVICE_INDISPONIBLE))\n\t\t.mockImplementationOnce(() => createFailure(ErreurM\xe9tier.DEMANDE_INCORRECTE))\n\t\t.mockImplementationOnce(() => createFailure(ErreurM\xe9tier.CONTENU_INDISPONIBLE),\n});\n"})}),"\n",(0,t.jsxs)(s.p,{children:["De plus, cette m\xe9thode pr\xe9sente l'inconv\xe9nient de ne pas pouvoir retourner un type union comme Either (Failure | Success) que nous utilisons beaucoup dans le projet. Le type \xe9tant inf\xe9r\xe9 de l'impl\xe9mentation qu'on donne au jest.fn, si cette impl\xe9mentation retourne une Failure comme l'exemple ci-dessus, ",(0,t.jsx)(s.code,{children:".mockImplementationOnce(() => createSuccess({...})"})," ne sera pas accept\xe9."]}),"\n",(0,t.jsx)(s.p,{children:"Nous ne voulons pas m\xe9langer deux m\xe9thodes de mock."}),"\n",(0,t.jsx)(s.h2,{id:"d\xe9cision",children:"D\xe9cision"}),"\n",(0,t.jsxs)(s.p,{children:["Pour \xe9viter d'avoir deux mani\xe8res de faire, la pr\xe9f\xe9rence est donn\xe9e \xe0 la m\xe9thode :\n",(0,t.jsx)(s.code,{children:"jest.spyOn(httpClientService, 'get').mockResolvedValue(...)"})," (= instancier la fixture de l'interface, et faire un spyOn dessus pour chaque mock qu'on veut mettre en place)"]}),"\n",(0,t.jsxs)(s.p,{children:["L'\xe9quipe s'accorde aussi sur le fait de ne pas initialiser des m\xe9thodes / valeurs test\xe9es dans un ",(0,t.jsx)(s.code,{children:"beforeEach"})," pour garder des tests\nautoportants."]}),"\n",(0,t.jsx)(s.h2,{id:"cons\xe9quences",children:"Cons\xe9quences"}),"\n",(0,t.jsx)(s.p,{children:"Les :"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"(httpClientService.get as jest.Mock).mockResolvedValue(...)"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"anHttpClientService({ get: jest.fn(async () => ({...}) })"})}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"et \xe9quivalent sur autres interfaces / m\xe9thodes sont d\xe9pr\xe9ci\xe9s"}),"\n",(0,t.jsx)(s.h2,{id:"autres-pistes-explor\xe9es",children:"Autres pistes explor\xe9es"})]})}function u(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>o});var t=n(6540);const r={},i=t.createContext(r);function c(e){const s=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);