"use strict";(self.webpackChunk_1j1s_front_docs=self.webpackChunk_1j1s_front_docs||[]).push([[678],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>v});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(n),m=a,v=p["".concat(s,".").concat(m)]||p[m]||d[m]||i;return n?r.createElement(v,o(o({ref:t},c),{},{components:n})):r.createElement(v,o({ref:t},c))}));function v(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:a,o[1]=l;for(var u=2;u<i;u++)o[u]=n[u];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4424:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>u});var r=n(7462),a=(n(7294),n(3905));const i={sidebar_label:"Le tracking, comment \xe7a marche ?",sidebar_position:1},o="Le tracking",l={unversionedId:"tuto/tracking",id:"tuto/tracking",title:"Le tracking",description:"28 Avril 2023",source:"@site/docs/tuto/tracking.md",sourceDirName:"tuto",slug:"/tuto/tracking",permalink:"/1j1s-front/docs/tuto/tracking",draft:!1,editUrl:"https://github.com/DNUM-SocialGouv/1j1s-front/tree/main/docs/docs/docs/tuto/tracking.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_label:"Le tracking, comment \xe7a marche ?",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"\ud83e\uddd1\u200d\ud83c\udf93 Tutoriels",permalink:"/1j1s-front/docs/category/-tutoriels"},next:{title:"La recherche via API, comment \xe7a marche ?",permalink:"/1j1s-front/docs/tuto/recherche-api"}},s={},u=[{value:"Introduction",id:"introduction",level:2},{value:"Comment \xe7a marche ?",id:"comment-\xe7a-marche-",level:2},{value:"Technologie utilis\xe9e : Eulerian",id:"technologie-utilis\xe9e--eulerian",level:2},{value:"Chargement de la librairie Eulerian",id:"chargement-de-la-librairie-eulerian",level:2},{value:"Int\xe9grer le service dans Tarte au citron",id:"int\xe9grer-le-service-dans-tarte-au-citron",level:2},{value:"M\xe9thode g\xe9n\xe9rale d&#39;envoi de donnn\xe9es vers Eulerian",id:"m\xe9thode-g\xe9n\xe9rale-denvoi-de-donnn\xe9es-vers-eulerian",level:2},{value:"Gestion des domaines",id:"gestion-des-domaines",level:2},{value:"Erreur CSP",id:"erreur-csp",level:2}],c={toc:u},p="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(p,(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"le-tracking"},"Le tracking"),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"28 Avril 2023")),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"Le tracking est un suivi et une analyse du comportement et des centres d'int\xe9r\xeats des utilisateurs sur notre produit."),(0,a.kt)("h2",{id:"comment-\xe7a-marche-"},"Comment \xe7a marche ?"),(0,a.kt)("p",null,"Le tracking (ou analytics) est d\xe9compos\xe9 en 2 cat\xe9gories de tags\xa0:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"impression = arriv\xe9e sur une page ou passage d'\xe9tape d'un formulaire."),(0,a.kt)("li",{parentName:"ul"},"\xe9v\xe9nements = interactions utilisateurs sur des call to actions")),(0,a.kt)("p",null,"Les fonctions correspondantes se trouvent dans\nl'",(0,a.kt)("a",{parentName:"p",href:"https://github.com/DNUM-SocialGouv/1j1s-front/blob/main/src/client/services/analytics/analytics.service.ts"},(0,a.kt)("inlineCode",{parentName:"a"},"AnalyticsService"))," et sont expos\xe9es aux composants depuis le\nhook ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/DNUM-SocialGouv/1j1s-front/blob/main/src/client/hooks/useAnalytics.ts"},(0,a.kt)("inlineCode",{parentName:"a"},"useAnalytics"))," qui s'occupe par d\xe9faut d'envoyer les analytics d'une page selon\nune configuration qui lui est envoy\xe9e. D'ailleurs, la configuration \xe0 envoyer de chaque page se trouve dans le dossier\nde la page en question, dans un fichier de la forme ",(0,a.kt)("inlineCode",{parentName:"p"},"*.analytics.ts"),"."),(0,a.kt)("h1",{id:"la-solution-utilis\xe9e"},"La solution utilis\xe9e"),(0,a.kt)("h2",{id:"technologie-utilis\xe9e--eulerian"},"Technologie utilis\xe9e : Eulerian"),(0,a.kt)("p",null,"L'ensemble des sites minist\xe9riels basculent sur la technologie Eulerian. La coupure de leur ancienne solution de tracking est pr\xe9vue pour le 16/03/2023. "),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/EulerianTechnologies/nextjs-eulerian-analytics"},"https://github.com/EulerianTechnologies/nextjs-eulerian-analytics")),(0,a.kt)("h2",{id:"chargement-de-la-librairie-eulerian"},"Chargement de la librairie Eulerian"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Script \xe0 positionner id\xe9alement au plus haut dans le ",(0,a.kt)("strong",{parentName:"p"},"head"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Toujours le placer avant les scripts de mesure de page, d'interaction/\xe9v\xe9nement, de conversion")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Remplacer '",(0,a.kt)("strong",{parentName:"p"},"mon.domainedetracking.com"),"' par le  domaine de mesure correspondant au site qui doit \xeatre mesur\xe9"))),(0,a.kt)("p",null,"ex : "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"script type=\"text/javascript\"\n    (function(e,a){var i=e.length,y=5381,k='script',s=window,v=document,o=v.createElement(k);for(;i;){i-=1;y=(y*33)^e.charCodeAt(i)}y='_EA_'+(y>>>=0);\n    (function(e,a,s,y){s[a]=s[a]||function(){(s[y]=s[y]||[]).push(arguments);s[y].eah=e;};}(e,a,s,y));i=new Date/1E7|0;o.ea=y;y=i%26;o.async=1;o.src='//'+e+'/'+String.fromCharCode(97+y,122-y,65+y)+(i%1E3)+'.js?2';s=v.getElementsByTagName(k)[0];s.parentNode.insertBefore(o,s);})\n('mon.domainedetracking.com','EA_push');\n")),(0,a.kt)("h2",{id:"int\xe9grer-le-service-dans-tarte-au-citron"},"Int\xe9grer le service dans Tarte au citron"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://eulerian.wiki/doku.php?id=fr:modules:collect:gdpr:tarteaucitron&s%5B%5D=tarteaucitron"},"https://eulerian.wiki/doku.php?id=fr:modules:collect:gdpr:tarteaucitron&s[]=tarteaucitron")),(0,a.kt)("h2",{id:"m\xe9thode-g\xe9n\xe9rale-denvoi-de-donnn\xe9es-vers-eulerian"},"M\xe9thode g\xe9n\xe9rale d'envoi de donnn\xe9es vers Eulerian"),(0,a.kt)("p",null,"Consignes d'impl\xe9mentation :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Le script est plac\xe9 dans une fonction anonyme auto-invoqu\xe9e"),(0,a.kt)("li",{parentName:"ul"},"Une variable EA_datalayer de type Array est cr\xe9\xe9e au scope global window"),(0,a.kt)("li",{parentName:"ul"},"Invoquer la m\xe9thode EA_datalayer.push() dans laquelle :",(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"Le premier argument sera le nom de la variable"),(0,a.kt)("li",{parentName:"ol"},"Le second argument sera la valeur de la variable\nExemple :\n",(0,a.kt)("inlineCode",{parentName:"li"},"data.push('key', 'value');")))),(0,a.kt)("li",{parentName:"ul"},"Une fois la construction de window.EA_datalayer finalis\xe9e, invoquer la fonction EA_push() dans laquelle nous passerons fnialement EA_data en argument.")),(0,a.kt)("p",null,"ex : "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"\"script type=\"\"text/javascript\"\n(function(){\n\n        // Cr\xe9ation d'un datalayer au scope global :\n        window.EA_datalayer = [];\n\n        // Donn\xe9es \xe0 envoyer (dimensions/m\xe9triques) \xe0 posser dans le datalayer :\n        window.EA_datalayer.push('dimension_personnalisee_X', '{{valeur X}}'); // etc.\n        window.EA_datalayer.push('metrique_personnalisee_Y', {{valeur Y}}); // etc.\n    \n        // Envoi des donn\xe9es :\n        window.EA_push(window.EA_datalayer);\n\n})();\n")),(0,a.kt)("h2",{id:"gestion-des-domaines"},"Gestion des domaines"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Obtenir le sous domaine de tracking pour l'environnement de recette qui sera sous la forme ",(0,a.kt)("strong",{parentName:"p"},"xxxx.recette.1jeune1solution.gouv.fr"),"\nLancer les demandes d'enregistrement CNAME pour les sous domaines de tracking, \xe0 transmettre \xe0 la DNUM.\nCa sera sous la forme :"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},'- yssn.1jeune1solution.gouv.fr. CNAME minsante.ent.et-gv.fr.\n- yssn.1jeune1solution.gouv.fr. CAA 0 issue "letsencrypt.org"\n- recette.1jeune1solution.gouv.fr. CNAME recette.1jeune1solution.gouv.fr.cdn.cloudflare.net.\n- xxxx.recette.1jeune1solution.gouv.fr. CNAME minsante.ent.et-gv.fr.\n- xxxx.recette.1jeune1solution.gouv.fr. CAA 0 issue "letsencrypt.org"\n'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Ajouter un enregistrement CNAME pour les review apps : *.review.1jeune1solution.gouv.fr CNAME scalingo.review.1jeune1solution.gouv.fr.cdn.cloudflare.net")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Modifier la variable d'environnement NEXT_PUBLIC_ANALYTICS_ENVIRONMENT en recette avec le nouveau sous domaine de tracking sous la forme xxxx.recette.1jeune1solution.gouv.fr")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Une fois les enregistrements CNAME effectu\xe9s et la recette sous sa nouvelle URL ",(0,a.kt)("a",{parentName:"p",href:"https://recette.1jeune1solution.gouv.fr"},"https://recette.1jeune1solution.gouv.fr"),", le tracking peut \xeatre recett\xe9 en l'activant via la variable d'environnement NEXT_PUBLIC_ANALYTICS_EULERIAN_FEATURE alors valoris\xe9e \xe0 1.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Mettre \xe0 jour les CSP"))),(0,a.kt)("h1",{id:"point-de-blocage-\xe9ventuels"},"Point de blocage \xe9ventuels"),(0,a.kt)("h2",{id:"erreur-csp"},"Erreur CSP"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Erreur rencontr\xe9e :")," \"refused to execute inline script because it violates the following Content Security Policy directive: \"script-src 'self' yssn.recette.1jeune1solution.gouv.fr\". Either the 'unsafe-inline' keyword, a hash ('sha256-XXXXX...'), or a nonce ('nonce-...') is required to enable inline execution.\""),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Action :")," d\xe9sactiver la csp / utiliser \xab unsafe-inline \xbb ?"))}d.isMDXComponent=!0}}]);