"use strict";(self.webpackChunk_1j1s_front=self.webpackChunk_1j1s_front||[]).push([[6472],{"./src/client/components/ui/Form/Select/SelectSimple/SelectSimple.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>SelectSimple});var SelectSimpleAction,jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),lodash_debounce=__webpack_require__("./node_modules/lodash.debounce/index.js"),lodash_debounce_default=__webpack_require__.n(lodash_debounce),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),keyboard_enum=__webpack_require__("./src/client/components/keyboard/keyboard.enum.ts"),Input=__webpack_require__("./src/client/components/ui/Form/Input/index.tsx"),SelectContext=__webpack_require__("./src/client/components/ui/Form/Select/SelectContext.tsx"),SelectOption=__webpack_require__("./src/client/components/ui/Form/Select/SelectOption/SelectOption.tsx"),Icon=__webpack_require__("./src/client/components/ui/Icon/Icon.tsx"),useTouchedInput=__webpack_require__("./src/client/hooks/useTouchedInput.ts"),Select_module=__webpack_require__("./src/client/components/ui/Form/Select/Select.module.scss");function getOptionsElement(refListOption){var _refListOption_current,_refListOption_current_querySelectorAll;return Array.from(null!==(_refListOption_current_querySelectorAll=null===(_refListOption_current=refListOption.current)||void 0===_refListOption_current?void 0:_refListOption_current.querySelectorAll('[role="option"]'))&&void 0!==_refListOption_current_querySelectorAll?_refListOption_current_querySelectorAll:[])}function SelectSimpleReducer(state,action){return action.execute(state)}!function(SelectSimpleAction){class OpenList{execute(previousState){let activeDescendant=previousState.activeDescendant;var _getOptionsElement_;previousState.activeDescendant||(activeDescendant=null===(_getOptionsElement_=getOptionsElement(previousState.refListOption)[0])||void 0===_getOptionsElement_?void 0:_getOptionsElement_.id);return{...previousState,activeDescendant,open:!0}}}SelectSimpleAction.OpenList=OpenList;class CloseList{execute(previousState){return{...previousState,open:!1}}}SelectSimpleAction.CloseList=CloseList;SelectSimpleAction.ToggleList=class ToggleList{execute(previousState){const{open}=previousState;return open?(new CloseList).execute(previousState):(new OpenList).execute(previousState)}};SelectSimpleAction.SetValueTypedByUser=class SetValueTypedByUser{execute(previousState){return{...previousState,userInput:this.newValue}}constructor(value){this.newValue=value}};SelectSimpleAction.ClearUserInput=class ClearUserInput{execute(previousState){return{...previousState,userInput:""}}};SelectSimpleAction.FocusOptionMatchingUserInput=class FocusOptionMatchingUserInput{execute(previousState){const allUserInput=previousState.userInput.concat(this.userInputKey),firstOptionMatchingUserInput=getOptionsElement(previousState.refListOption).find((function optionMatchUserInput(optionElement){var _optionElement_textContent;return null===(_optionElement_textContent=optionElement.textContent)||void 0===_optionElement_textContent?void 0:_optionElement_textContent.toLowerCase().startsWith(allUserInput.toLowerCase())}));var _firstOptionMatchingUserInput_id;return{...previousState,activeDescendant:null!==(_firstOptionMatchingUserInput_id=null==firstOptionMatchingUserInput?void 0:firstOptionMatchingUserInput.id)&&void 0!==_firstOptionMatchingUserInput_id?_firstOptionMatchingUserInput_id:previousState.activeDescendant,open:!0,userInput:allUserInput}}constructor(userInputKey){this.userInputKey=userInputKey}};SelectSimpleAction.FocusFirstOption=class FocusFirstOption{execute(previousState){var _getOptionsElement_;return{...previousState,activeDescendant:null===(_getOptionsElement_=getOptionsElement(previousState.refListOption)[0])||void 0===_getOptionsElement_?void 0:_getOptionsElement_.id,open:!0}}};SelectSimpleAction.FocusLastOption=class FocusLastOption{execute(previousState){const lastOption=getOptionsElement(previousState.refListOption).at(-1);return{...previousState,activeDescendant:null==lastOption?void 0:lastOption.id,open:!0}}};SelectSimpleAction.NextOption=class NextOption{execute(previousState){const{activeDescendant,refListOption}=previousState,options=getOptionsElement(refListOption),currentActiveDescendantIndex=options.findIndex((node=>node.id===activeDescendant));var _options_;const nextDescendant=null!==(_options_=options[currentActiveDescendantIndex+this.numberOfOptionAfter])&&void 0!==_options_?_options_:options.at(-1);return{...previousState,activeDescendant:null==nextDescendant?void 0:nextDescendant.id,open:!0}}constructor(relativeNumberOfOptionAfter){this.numberOfOptionAfter=null!=relativeNumberOfOptionAfter?relativeNumberOfOptionAfter:1}};SelectSimpleAction.PreviousOption=class PreviousOption{execute(previousState){const{activeDescendant,refListOption}=previousState,options=getOptionsElement(refListOption),currentActiveDescendantIndex=options.findIndex((node=>node.id===activeDescendant));var _options_;const previousDescendant=null!==(_options_=options[currentActiveDescendantIndex-this.numberOfOptionBefore])&&void 0!==_options_?_options_:options[0];return{...previousState,activeDescendant:null==previousDescendant?void 0:previousDescendant.id,open:!0}}constructor(relativeNumberOfOptionBefore){this.numberOfOptionBefore=null!=relativeNumberOfOptionBefore?relativeNumberOfOptionBefore:1}};SelectSimpleAction.SelectOption=class SelectOption{execute(previousState){var _this_option;var _this_option_getAttribute;return{...(new CloseList).execute(previousState),selectedValue:null!==(_this_option_getAttribute=null===(_this_option=this.option)||void 0===_this_option?void 0:_this_option.getAttribute("data-value"))&&void 0!==_this_option_getAttribute?_this_option_getAttribute:""}}constructor(option){this.option=option instanceof Element?option:document.getElementById(option)}}}(SelectSimpleAction||(SelectSimpleAction={}));const DEFAULT_PLACEHOLDER="SÃ©lectionnez votre choix",DEFAULT_DEBOUNCE_TIMEOUT=300;function SelectSimple({optionsAriaLabel,children,value:valueProps,placeholder:placeholderProps,name,onChange:onChangeProps=doNothing,onFocus:onFocusProps=doNothing,onInvalid:onInvalidProps=doNothing,onTouch:onTouchProps=doNothing,defaultValue,required,...rest}){const listboxRef=(0,react.useRef)(null),inputHiddenRef=(0,react.useRef)(null),listboxId=(0,react.useId)(),{saveValueOnFocus,setTouchedOnBlur,touched}=(0,useTouchedInput.g)(),[{activeDescendant,open,selectedValue:valueState},dispatch]=(0,react.useReducer)(SelectSimpleReducer,{activeDescendant:void 0,open:!1,refListOption:listboxRef,selectedValue:null!=defaultValue?defaultValue:"",userInput:"",visibleOptions:[]}),value=null!=valueProps?valueProps:valueState,placeholder=function useDisplayName(value,listRef,placeholder){const[displayName,setDisplayName]=(0,react.useState)(""),getDisplayName=(0,react.useCallback)((value=>{if(!value)return;const optionSelected=getOptionsElement(listRef).find((option=>option.getAttribute("data-value")===value));return null==optionSelected?void 0:optionSelected.textContent}),[listRef]);return(0,react.useEffect)((()=>{var _getDisplayName,_ref;setDisplayName(null!==(_ref=null!==(_getDisplayName=getDisplayName(value))&&void 0!==_getDisplayName?_getDisplayName:placeholder)&&void 0!==_ref?_ref:DEFAULT_PLACEHOLDER)}),[value,placeholder,getDisplayName]),displayName}(value,listboxRef,placeholderProps);(0,react.useEffect)((function checkValidityOnChange(){var _inputHiddenRef_current;touched&&(null===(_inputHiddenRef_current=inputHiddenRef.current)||void 0===_inputHiddenRef_current||_inputHiddenRef_current.checkValidity())}),[value,touched]);const selectOption=(0,react.useCallback)((function selectOption(optionId){dispatch(new SelectSimpleAction.SelectOption(optionId));const option=document.getElementById(optionId);option&&onChangeProps(option)}),[onChangeProps]);(0,react.useLayoutEffect)((function scrollOptionIntoView(){var _document_getElementById;activeDescendant&&(null===(_document_getElementById=document.getElementById(activeDescendant))||void 0===_document_getElementById||_document_getElementById.scrollIntoView({behavior:"smooth",block:"nearest"}))}),[activeDescendant]);const onFocus=(0,react.useCallback)((function onFocus(event){saveValueOnFocus(null!=value?value:""),onFocusProps(event)}),[onFocusProps,saveValueOnFocus,value]),onBlur=(0,react.useCallback)((function onBlur(event){if(event.currentTarget.contains(event.relatedTarget))return void cancelEvent(event);const touched=setTouchedOnBlur(null!=value?value:"");touched&&onTouchProps(touched),dispatch(new SelectSimpleAction.CloseList)}),[onTouchProps,setTouchedOnBlur,value]),isSelected=(0,react.useCallback)((function isSelected(optionValue){return value===optionValue}),[value]),clearUserInput=(0,react.useMemo)((()=>lodash_debounce_default()((()=>dispatch(new SelectSimpleAction.ClearUserInput)),DEFAULT_DEBOUNCE_TIMEOUT)),[]),onKeyDown=(0,react.useCallback)((function onKeyDown(event){const{key,altKey,ctrlKey,metaKey}=event;switch(1===event.key.length&&event.key!==keyboard_enum.A.SPACE&&!altKey&&!ctrlKey&&!metaKey&&(event.preventDefault(),dispatch(new SelectSimpleAction.FocusOptionMatchingUserInput(key)),clearUserInput()),key){case keyboard_enum.A.PAGE_UP:open&&(event.preventDefault(),dispatch(new SelectSimpleAction.PreviousOption(10)));break;case keyboard_enum.A.PAGE_DOWN:open&&(event.preventDefault(),dispatch(new SelectSimpleAction.NextOption(10)));break;case keyboard_enum.A.ARROW_UP:case keyboard_enum.A.IE_ARROW_UP:open?altKey?activeDescendant&&selectOption(activeDescendant):dispatch(new SelectSimpleAction.PreviousOption):dispatch(new SelectSimpleAction.OpenList),event.preventDefault();break;case keyboard_enum.A.ARROW_DOWN:case keyboard_enum.A.IE_ARROW_DOWN:dispatch(open?new SelectSimpleAction.NextOption:new SelectSimpleAction.OpenList),event.preventDefault();break;case keyboard_enum.A.ESCAPE:case keyboard_enum.A.IE_ESCAPE:open&&(event.preventDefault(),dispatch(new SelectSimpleAction.CloseList));break;case keyboard_enum.A.SPACE:case keyboard_enum.A.ENTER:open?activeDescendant&&(selectOption(activeDescendant),event.preventDefault()):(cancelEvent(event),dispatch(new SelectSimpleAction.OpenList));break;case keyboard_enum.A.TAB:open&&activeDescendant&&selectOption(activeDescendant);break;case keyboard_enum.A.HOME:dispatch(new SelectSimpleAction.FocusFirstOption),event.preventDefault();break;case keyboard_enum.A.END:dispatch(new SelectSimpleAction.FocusLastOption),event.preventDefault()}}),[activeDescendant,clearUserInput,open,selectOption]);return(0,jsx_runtime.jsx)(SelectContext.C.Provider,{value:{activeDescendant,isCurrentItemSelected:isSelected,onOptionSelection:selectOption},children:(0,jsx_runtime.jsxs)("div",{className:Select_module.A.container,children:[(0,jsx_runtime.jsx)(Input.p,{ref:inputHiddenRef,tabIndex:-1,required,"aria-hidden":"true",name,onInvalid:onInvalidProps,value}),(0,jsx_runtime.jsxs)("button",{type:"button",role:"combobox","aria-controls":listboxId,"aria-haspopup":"listbox","aria-expanded":open,"data-touched":touched,"aria-required":required,onClick:()=>dispatch(new SelectSimpleAction.ToggleList),"aria-activedescendant":activeDescendant,onKeyDown,onBlur,onFocus,...rest,children:[placeholder,(0,jsx_runtime.jsx)(Icon.I,{name:"angle-down"})]}),(0,jsx_runtime.jsx)("ul",{role:"listbox",ref:listboxRef,"aria-label":optionsAriaLabel,id:listboxId,tabIndex:-1,hidden:!open,children})]})})}function cancelEvent(event){event.preventDefault(),event.stopPropagation()}function doNothing(){}SelectSimple.Option=SelectOption.O,SelectSimple.__docgenInfo={description:"",methods:[{name:"Option",docblock:null,modifiers:["static"],params:[{name:"{ className, value: valueProps, id: idProps, ...rest }: SelectOptionProps",optional:!1,type:{name:"intersection",raw:"Omit<React.ComponentPropsWithoutRef<'li'>, 'value'> & {\n\t// FIXME (GAFI 21-08-2024): Ãa peut pas Ãªtre optionnel ?\n\tvalue: { toString: () => string },\n}",elements:[{name:"Omit",elements:[{name:"ReactComponentPropsWithoutRef",raw:"React.ComponentPropsWithoutRef<'li'>",elements:[{name:"literal",value:"'li'"}]},{name:"literal",value:"'value'"}],raw:"Omit<React.ComponentPropsWithoutRef<'li'>, 'value'>"},{name:"signature",type:"object",raw:"{\n\t// FIXME (GAFI 21-08-2024): Ãa peut pas Ãªtre optionnel ?\n\tvalue: { toString: () => string },\n}",signature:{properties:[{key:"value",value:{name:"signature",type:"object",raw:"{ toString: () => string }",signature:{properties:[{key:"toString",value:{name:"signature",type:"function",raw:"() => string",signature:{arguments:[],return:{name:"string"}},required:!0}}]},required:!0}}]}}],alias:"SelectOptionProps"}}],returns:null}],displayName:"SelectSimple",props:{value:{required:!1,tsType:{name:"string"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: HTMLElement) => void",signature:{arguments:[{type:{name:"HTMLElement"},name:"value"}],return:{name:"void"}}},description:"",defaultValue:{value:"function doNothing() {\n\treturn;\n}",computed:!1}},defaultValue:{required:!1,tsType:{name:"string"},description:""},onTouch:{required:!1,tsType:{name:"signature",type:"function",raw:"(touched: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"touched"}],return:{name:"void"}}},description:"",defaultValue:{value:"function doNothing() {\n\treturn;\n}",computed:!1}},placeholder:{required:!1,tsType:{name:"string"},description:""},required:{required:!1,tsType:{name:"boolean"},description:""},onInvalid:{required:!1,tsType:{name:"FormEventHandler",elements:[{name:"HTMLInputElement"}],raw:"FormEventHandler<HTMLInputElement>"},description:"",defaultValue:{value:"function doNothing() {\n\treturn;\n}",computed:!1}},optionsAriaLabel:{required:!0,tsType:{name:"string"},description:""},onFocus:{defaultValue:{value:"function doNothing() {\n\treturn;\n}",computed:!1},required:!1}}}}}]);