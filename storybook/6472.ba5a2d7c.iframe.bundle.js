"use strict";(self.webpackChunk_1j1s_front=self.webpackChunk_1j1s_front||[]).push([[6472],{"./src/client/components/ui/Form/Select/SelectSimple/SelectSimple.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>SelectSimple});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),lodash_debounce=__webpack_require__("./node_modules/lodash.debounce/index.js"),lodash_debounce_default=__webpack_require__.n(lodash_debounce),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),keyboard_enum=__webpack_require__("./src/client/components/keyboard/keyboard.enum.ts"),Input=__webpack_require__("./src/client/components/ui/Form/Input/index.tsx"),Select_utils=__webpack_require__("./src/client/components/ui/Form/Select/Select.utils.ts"),SelectContext=__webpack_require__("./src/client/components/ui/Form/Select/SelectContext.tsx"),SelectOption=__webpack_require__("./src/client/components/ui/Form/Select/SelectOption/SelectOption.tsx"),Icon=__webpack_require__("./src/client/components/ui/Icon/Icon.tsx"),useTouchedInput=__webpack_require__("./src/client/hooks/useTouchedInput.ts"),Select_module=__webpack_require__("./src/client/components/ui/Form/Select/Select.module.scss");class SelectSimpleActionOpenList{execute(previousState){let activeDescendant=previousState.activeDescendant;var _this_options_;previousState.activeDescendant||(activeDescendant=null===(_this_options_=this.options[0])||void 0===_this_options_?void 0:_this_options_.id);return{...previousState,activeDescendant,open:!0}}constructor(options){this.options=options}}class SelectSimpleActionCloseList{execute(previousState){return{...previousState,open:!1}}}class SelectSimpleActionToggleList{execute(previousState){const{open}=previousState;return open?(new SelectSimpleActionCloseList).execute(previousState):new SelectSimpleActionOpenList(this.options).execute(previousState)}constructor(options){this.options=options}}class SelectSimpleActionClearUserInput{execute(previousState){return{...previousState,userInput:""}}}class SelectSimpleActionFocusOptionMatchingUserInput{execute(previousState){const allUserInput=previousState.userInput.concat(this.userInputKey),firstOptionMatchingUserInput=this.options.find(function optionMatchUserInput(optionElement){var _optionElement_textContent;return null===(_optionElement_textContent=optionElement.textContent)||void 0===_optionElement_textContent?void 0:_optionElement_textContent.toLowerCase().startsWith(allUserInput.toLowerCase())});var _firstOptionMatchingUserInput_id;return{...previousState,activeDescendant:null!==(_firstOptionMatchingUserInput_id=null==firstOptionMatchingUserInput?void 0:firstOptionMatchingUserInput.id)&&void 0!==_firstOptionMatchingUserInput_id?_firstOptionMatchingUserInput_id:previousState.activeDescendant,open:!0,userInput:allUserInput}}constructor(userInputKey,options){this.userInputKey=userInputKey,this.options=options}}class SelectSimpleActionFocusFirstOption{execute(previousState){var _this_options_;return{...previousState,activeDescendant:null===(_this_options_=this.options[0])||void 0===_this_options_?void 0:_this_options_.id,open:!0}}constructor(options){this.options=options}}class SelectSimpleActionFocusLastOption{execute(previousState){const lastOption=this.options.at(-1);return{...previousState,activeDescendant:null==lastOption?void 0:lastOption.id,open:!0}}constructor(options){this.options=options}}class SelectSimpleActionNextOption{execute(previousState){const{activeDescendant}=previousState,currentActiveDescendantIndex=this.options.findIndex(node=>node.id===activeDescendant);var _this_options_;const nextDescendant=null!==(_this_options_=this.options[currentActiveDescendantIndex+this.numberOfOptionAfter])&&void 0!==_this_options_?_this_options_:this.options.at(-1);return{...previousState,activeDescendant:null==nextDescendant?void 0:nextDescendant.id,open:!0}}constructor(options,relativeNumberOfOptionAfter){this.options=options,this.numberOfOptionAfter=null!=relativeNumberOfOptionAfter?relativeNumberOfOptionAfter:1}}class SelectSimpleActionPreviousOption{execute(previousState){const{activeDescendant}=previousState,currentActiveDescendantIndex=this.options.findIndex(node=>node.id===activeDescendant);var _this_options_;const previousDescendant=null!==(_this_options_=this.options[currentActiveDescendantIndex-this.numberOfOptionBefore])&&void 0!==_this_options_?_this_options_:this.options[0];return{...previousState,activeDescendant:null==previousDescendant?void 0:previousDescendant.id,open:!0}}constructor(options,relativeNumberOfOptionBefore){this.options=options,this.numberOfOptionBefore=null!=relativeNumberOfOptionBefore?relativeNumberOfOptionBefore:1}}class SelectSimpleActionSelectOption{execute(previousState){var _this_option;var _this_option_getAttribute;return{...(new SelectSimpleActionCloseList).execute(previousState),selectedValue:null!==(_this_option_getAttribute=null===(_this_option=this.option)||void 0===_this_option?void 0:_this_option.getAttribute("data-value"))&&void 0!==_this_option_getAttribute?_this_option_getAttribute:""}}constructor(option){this.option=option instanceof Element?option:document.getElementById(option)}}function SelectSimpleReducer(state,action){return action.execute(state)}const DEFAULT_PLACEHOLDER="SÃ©lectionnez votre choix",DEFAULT_DEBOUNCE_TIMEOUT=300;function SelectSimple({optionsAriaLabel,children,value:valueProps,placeholder:placeholderProps,name,onChange:onChangeProps=doNothing,onFocus:onFocusProps=doNothing,onInvalid:onInvalidProps=doNothing,onTouch:onTouchProps=doNothing,defaultValue,required,...rest}){const listboxRef=(0,react.useRef)(null),inputHiddenRef=(0,react.useRef)(null),listboxId=(0,react.useId)(),{saveValueOnFocus,setTouchedOnBlur,touched}=(0,useTouchedInput.g)(),[{activeDescendant,open,selectedValue:valueState},dispatch]=(0,react.useReducer)(SelectSimpleReducer,{activeDescendant:void 0,open:!1,selectedValue:null!=defaultValue?defaultValue:"",userInput:"",visibleOptions:[]});function getOptions(){var _listboxRef_current,_listboxRef_current_querySelectorAll;return Array.from(null!==(_listboxRef_current_querySelectorAll=null===(_listboxRef_current=listboxRef.current)||void 0===_listboxRef_current?void 0:_listboxRef_current.querySelectorAll('[role="option"]'))&&void 0!==_listboxRef_current_querySelectorAll?_listboxRef_current_querySelectorAll:[])}const value=null!=valueProps?valueProps:valueState,placeholder=function useDisplayName(value,children,placeholder){return(0,react.useMemo)(()=>{if(!value)return null!=placeholder?placeholder:DEFAULT_PLACEHOLDER;let displayName;var _ref;return react.Children.forEach(children,child=>{var _child_props_value;react.isValidElement(child)&&(null===(_child_props_value=child.props.value)||void 0===_child_props_value?void 0:_child_props_value.toString())===value&&(displayName=extractTextContent(child.props.children))}),null!==(_ref=null!=displayName?displayName:placeholder)&&void 0!==_ref?_ref:DEFAULT_PLACEHOLDER},[value,children,placeholder])}(value,children,placeholderProps);(0,react.useEffect)(function checkValidityOnChange(){var _inputHiddenRef_current;touched&&(null===(_inputHiddenRef_current=inputHiddenRef.current)||void 0===_inputHiddenRef_current||_inputHiddenRef_current.checkValidity())},[value,touched]);const selectOption=(0,react.useCallback)(function selectOption(optionId){dispatch(new SelectSimpleActionSelectOption(optionId));const option=document.getElementById(optionId);option&&onChangeProps(option)},[onChangeProps]);(0,react.useLayoutEffect)(function scrollOptionIntoView(){var _document_getElementById;activeDescendant&&(null===(_document_getElementById=document.getElementById(activeDescendant))||void 0===_document_getElementById||_document_getElementById.scrollIntoView({behavior:"smooth",block:"nearest"}))},[activeDescendant]);const onFocus=(0,react.useCallback)(function onFocus(event){saveValueOnFocus(null!=value?value:""),onFocusProps(event)},[onFocusProps,saveValueOnFocus,value]),onBlur=(0,react.useCallback)(function onBlur(event){if(event.currentTarget.contains(event.relatedTarget))return void cancelEvent(event);const touched=setTouchedOnBlur(null!=value?value:"");touched&&onTouchProps(touched),dispatch(new SelectSimpleActionCloseList)},[onTouchProps,setTouchedOnBlur,value]),isSelected=(0,react.useCallback)(function isSelected(optionValue){return value===optionValue},[value]),clearUserInput=(0,react.useMemo)(()=>lodash_debounce_default()(()=>dispatch(new SelectSimpleActionClearUserInput),DEFAULT_DEBOUNCE_TIMEOUT),[]),onKeyDown=(0,react.useCallback)(function onKeyDown(event){const{key,altKey}=event,options=getOptions();switch((0,Select_utils.A)(event.nativeEvent)&&(event.preventDefault(),dispatch(new SelectSimpleActionFocusOptionMatchingUserInput(key,options)),clearUserInput()),key){case keyboard_enum.A.PAGE_UP:open&&(event.preventDefault(),dispatch(new SelectSimpleActionPreviousOption(options,10)));break;case keyboard_enum.A.PAGE_DOWN:open&&(event.preventDefault(),dispatch(new SelectSimpleActionNextOption(options,10)));break;case keyboard_enum.A.ARROW_UP:case keyboard_enum.A.IE_ARROW_UP:open?altKey?activeDescendant&&selectOption(activeDescendant):dispatch(new SelectSimpleActionPreviousOption(options)):dispatch(new SelectSimpleActionOpenList(options)),event.preventDefault();break;case keyboard_enum.A.ARROW_DOWN:case keyboard_enum.A.IE_ARROW_DOWN:dispatch(open?new SelectSimpleActionNextOption(options):new SelectSimpleActionOpenList(options)),event.preventDefault();break;case keyboard_enum.A.ESCAPE:case keyboard_enum.A.IE_ESCAPE:open&&(event.preventDefault(),dispatch(new SelectSimpleActionCloseList));break;case keyboard_enum.A.SPACE:case keyboard_enum.A.ENTER:open?activeDescendant&&(selectOption(activeDescendant),event.preventDefault()):(cancelEvent(event),dispatch(new SelectSimpleActionOpenList(options)));break;case keyboard_enum.A.TAB:open&&activeDescendant&&selectOption(activeDescendant);break;case keyboard_enum.A.HOME:dispatch(new SelectSimpleActionFocusFirstOption(options)),event.preventDefault();break;case keyboard_enum.A.END:dispatch(new SelectSimpleActionFocusLastOption(options)),event.preventDefault()}},[activeDescendant,clearUserInput,open,selectOption]);return(0,jsx_runtime.jsx)(SelectContext.C.Provider,{value:{activeDescendant,isCurrentItemSelected:isSelected,onOptionSelection:selectOption},children:(0,jsx_runtime.jsxs)("div",{className:Select_module.A.container,children:[(0,jsx_runtime.jsx)(Input.p,{ref:inputHiddenRef,tabIndex:-1,required,"aria-hidden":"true",name,onInvalid:onInvalidProps,value}),(0,jsx_runtime.jsxs)("button",{type:"button",role:"combobox","aria-controls":listboxId,"aria-haspopup":"listbox","aria-expanded":open,"data-touched":touched,"aria-required":required,onClick:()=>dispatch(new SelectSimpleActionToggleList(getOptions())),"aria-activedescendant":activeDescendant,onKeyDown,onBlur,onFocus,...rest,children:[placeholder,(0,jsx_runtime.jsx)(Icon.I,{name:"angle-down"})]}),(0,jsx_runtime.jsx)("ul",{role:"listbox",ref:listboxRef,"aria-label":optionsAriaLabel,id:listboxId,tabIndex:-1,hidden:!open,children})]})})}function cancelEvent(event){event.preventDefault(),event.stopPropagation()}function doNothing(){}function extractTextContent(node){return"string"==typeof node?node:"number"==typeof node?String(node):Array.isArray(node)?node.map(extractTextContent).join(""):react.isValidElement(node)?extractTextContent(node.props.children):""}SelectSimple.Option=SelectOption.O,SelectSimple.__docgenInfo={description:"",methods:[],displayName:"SelectSimple",props:{value:{required:!1,tsType:{name:"string"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: HTMLElement) => void",signature:{arguments:[{type:{name:"HTMLElement"},name:"value"}],return:{name:"void"}}},description:"",defaultValue:{value:"function doNothing() {\n\treturn;\n}",computed:!1}},defaultValue:{required:!1,tsType:{name:"string"},description:""},onTouch:{required:!1,tsType:{name:"signature",type:"function",raw:"(touched: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"touched"}],return:{name:"void"}}},description:"",defaultValue:{value:"function doNothing() {\n\treturn;\n}",computed:!1}},placeholder:{required:!1,tsType:{name:"string"},description:""},required:{required:!1,tsType:{name:"boolean"},description:""},onInvalid:{required:!1,tsType:{name:"FormEventHandler",elements:[{name:"HTMLInputElement"}],raw:"FormEventHandler<HTMLInputElement>"},description:"",defaultValue:{value:"function doNothing() {\n\treturn;\n}",computed:!1}},optionsAriaLabel:{required:!0,tsType:{name:"string"},description:""},onFocus:{defaultValue:{value:"function doNothing() {\n\treturn;\n}",computed:!1},required:!1}}}}}]);