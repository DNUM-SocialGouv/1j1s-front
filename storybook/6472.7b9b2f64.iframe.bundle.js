"use strict";(self.webpackChunk_1j1s_front=self.webpackChunk_1j1s_front||[]).push([[6472],{"./src/client/components/ui/Form/Select/SelectSimple/SelectSimple.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>SelectSimple});var SelectSimpleAction,jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),lodash_debounce=__webpack_require__("./node_modules/lodash.debounce/index.js"),lodash_debounce_default=__webpack_require__.n(lodash_debounce),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),keyboard_enum=__webpack_require__("./src/client/components/keyboard/keyboard.enum.ts"),Input=__webpack_require__("./src/client/components/ui/Form/Input/index.tsx"),SelectContext=__webpack_require__("./src/client/components/ui/Form/Select/SelectContext.tsx"),SelectOption=__webpack_require__("./src/client/components/ui/Form/Select/SelectOption/SelectOption.tsx"),Icon=__webpack_require__("./src/client/components/ui/Icon/Icon.tsx"),Select_module=__webpack_require__("./src/client/components/ui/Form/Select/Select.module.scss");function getOptionsElement(refListOption){var _refListOption_current,_refListOption_current_querySelectorAll;return Array.from(null!==(_refListOption_current_querySelectorAll=null===(_refListOption_current=refListOption.current)||void 0===_refListOption_current?void 0:_refListOption_current.querySelectorAll('[role="option"]'))&&void 0!==_refListOption_current_querySelectorAll?_refListOption_current_querySelectorAll:[])}function SelectSimpleReducer(state,action){return action.execute(state)}!function(SelectSimpleAction){class OpenList{execute(previousState){let activeDescendant=previousState.activeDescendant;var _getOptionsElement_;previousState.activeDescendant||(activeDescendant=null===(_getOptionsElement_=getOptionsElement(previousState.refListOption)[0])||void 0===_getOptionsElement_?void 0:_getOptionsElement_.id);return{...previousState,activeDescendant,isListOptionsOpen:!0}}}SelectSimpleAction.OpenList=OpenList;class CloseList{execute(previousState){return{...previousState,isListOptionsOpen:!1}}}SelectSimpleAction.CloseList=CloseList;SelectSimpleAction.ToggleList=class ToggleList{execute(previousState){const{isListOptionsOpen}=previousState;return isListOptionsOpen?(new CloseList).execute(previousState):(new OpenList).execute(previousState)}};SelectSimpleAction.SetValueTypedByUser=class SetValueTypedByUser{execute(previousState){return{...previousState,valueTypedByUser:this.newValue}}constructor(value){this.newValue=value}};SelectSimpleAction.FocusOptionMatchingUserInput=class FocusOptionMatchingUserInput{execute(previousState){const allUserInput=previousState.valueTypedByUser.concat(this.userInputKey),firstOptionMatchingUserInput=getOptionsElement(previousState.refListOption).find((function optionMatchUserInput(optionElement){var _optionElement_textContent;return null===(_optionElement_textContent=optionElement.textContent)||void 0===_optionElement_textContent?void 0:_optionElement_textContent.toLowerCase().startsWith(allUserInput.toLowerCase())}));var _firstOptionMatchingUserInput_id;return{...previousState,activeDescendant:null!==(_firstOptionMatchingUserInput_id=null==firstOptionMatchingUserInput?void 0:firstOptionMatchingUserInput.id)&&void 0!==_firstOptionMatchingUserInput_id?_firstOptionMatchingUserInput_id:previousState.activeDescendant,valueTypedByUser:allUserInput}}constructor(userInputKey){this.userInputKey=userInputKey}};SelectSimpleAction.FocusFirstOption=class FocusFirstOption{execute(previousState){var _getOptionsElement_;return{...previousState,activeDescendant:null===(_getOptionsElement_=getOptionsElement(previousState.refListOption)[0])||void 0===_getOptionsElement_?void 0:_getOptionsElement_.id}}};SelectSimpleAction.FocusLastOption=class FocusLastOption{execute(previousState){const lastOption=getOptionsElement(previousState.refListOption).at(-1);return{...previousState,activeDescendant:null==lastOption?void 0:lastOption.id}}};SelectSimpleAction.NextOption=class NextOption{execute(previousState){const{activeDescendant,refListOption}=previousState,options=getOptionsElement(refListOption),currentActiveDescendantIndex=options.findIndex((node=>node.id===activeDescendant));var _options_;const nextDescendant=null!==(_options_=options[currentActiveDescendantIndex+this.numberOfOptionAfter])&&void 0!==_options_?_options_:options.at(-1);return{...previousState,activeDescendant:null==nextDescendant?void 0:nextDescendant.id,isListOptionsOpen:!0}}constructor(relativeNumberOfOptionAfter){this.numberOfOptionAfter=null!=relativeNumberOfOptionAfter?relativeNumberOfOptionAfter:1}};SelectSimpleAction.PreviousOption=class PreviousOption{execute(previousState){const{activeDescendant,refListOption}=previousState,options=getOptionsElement(refListOption),currentActiveDescendantIndex=options.findIndex((node=>node.id===activeDescendant));var _options_;const previousDescendant=null!==(_options_=options[currentActiveDescendantIndex-this.numberOfOptionBefore])&&void 0!==_options_?_options_:options[0];return{...previousState,activeDescendant:null==previousDescendant?void 0:previousDescendant.id,isListOptionsOpen:!0}}constructor(relativeNumberOfOptionBefore){this.numberOfOptionBefore=null!=relativeNumberOfOptionBefore?relativeNumberOfOptionBefore:1}};SelectSimpleAction.SelectOption=class SelectOption{execute(previousState){var _this_option;var _this_option_getAttribute;return{...(new CloseList).execute(previousState),optionSelectedValue:null!==(_this_option_getAttribute=null===(_this_option=this.option)||void 0===_this_option?void 0:_this_option.getAttribute("data-value"))&&void 0!==_this_option_getAttribute?_this_option_getAttribute:""}}constructor(option){this.option=option instanceof Element?option:document.getElementById(option)}}}(SelectSimpleAction||(SelectSimpleAction={}));const ERROR_LABEL_REQUIRED_SIMPLE="Séléctionnez un élément de la liste",SELECT_PLACEHOLDER_SINGULAR="Sélectionnez votre choix",DEFAULT_DEBOUNCE_TIMEOUT=300;function SelectSimple(props){const{optionsAriaLabel,children,value,placeholder:placeholderProps,name,onChange:onChangeProps=doNothing,onInvalid:onInvalidProps=doNothing,onTouch:onTouchProps=doNothing,defaultValue,required,...rest}=props,listboxRef=(0,react.useRef)(null),inputHiddenRef=(0,react.useRef)(null),listboxId=(0,react.useId)(),[touched,setTouched]=(0,react.useState)(!1),[placeholder,setPlaceholder]=(0,react.useState)(),[state,dispatch]=(0,react.useReducer)(SelectSimpleReducer,{activeDescendant:void 0,isListOptionsOpen:!1,optionSelectedValue:defaultValue||"",refListOption:listboxRef,valueTypedByUser:"",visibleOptions:[]}),optionSelectedValue=null!=value?value:state.optionSelectedValue,placeholderWhenValueSelected=(0,react.useCallback)((()=>{if(optionSelectedValue){const optionSelected=getOptionsElement(listboxRef).find((option=>option.getAttribute("data-value")===optionSelectedValue));return null==optionSelected?void 0:optionSelected.textContent}}),[optionSelectedValue]);(0,react.useEffect)((()=>{var _placeholderWhenValueSelected,_ref;setPlaceholder(null!==(_ref=null!==(_placeholderWhenValueSelected=placeholderWhenValueSelected())&&void 0!==_placeholderWhenValueSelected?_placeholderWhenValueSelected:placeholderProps)&&void 0!==_ref?_ref:SELECT_PLACEHOLDER_SINGULAR)}),[optionSelectedValue,placeholderProps,placeholderWhenValueSelected]);const selectOption=(0,react.useCallback)((optionId=>{var _inputHiddenRef_current;setTouched(!0),onTouchProps(!0),null===(_inputHiddenRef_current=inputHiddenRef.current)||void 0===_inputHiddenRef_current||_inputHiddenRef_current.setCustomValidity(""),dispatch(new SelectSimpleAction.SelectOption(optionId));const option=document.getElementById(optionId);option&&onChangeProps(option)}),[onChangeProps,onTouchProps]),closeList=(0,react.useCallback)((()=>{var _inputHiddenRef_current,_inputHiddenRef_current1;(dispatch(new SelectSimpleAction.CloseList),onTouchProps(!0),setTouched(!0),required&&!optionSelectedValue)&&(null===(_inputHiddenRef_current1=inputHiddenRef.current)||void 0===_inputHiddenRef_current1||_inputHiddenRef_current1.setCustomValidity(ERROR_LABEL_REQUIRED_SIMPLE));null===(_inputHiddenRef_current=inputHiddenRef.current)||void 0===_inputHiddenRef_current||_inputHiddenRef_current.checkValidity()}),[onTouchProps,optionSelectedValue,required]);(0,react.useLayoutEffect)((function scrollOptionIntoView(){var _document_getElementById;state.activeDescendant&&(null===(_document_getElementById=document.getElementById(state.activeDescendant))||void 0===_document_getElementById||_document_getElementById.scrollIntoView({behavior:"smooth",block:"nearest"}))}),[state.activeDescendant]);const onBlur=(0,react.useCallback)((function onBlur(event){event.currentTarget.contains(event.relatedTarget)?cancelEvent(event):closeList()}),[closeList]),isCurrentItemSelected=(0,react.useCallback)((optionValue=>optionSelectedValue===optionValue),[optionSelectedValue]),resetValueTypedByUser=(0,react.useCallback)((()=>{dispatch(new SelectSimpleAction.SetValueTypedByUser(""))}),[]),handlefocusOnTypeLetterDebounce=(0,react.useMemo)((()=>lodash_debounce_default()(resetValueTypedByUser,DEFAULT_DEBOUNCE_TIMEOUT)),[resetValueTypedByUser]),onKeyDown=(0,react.useCallback)((function onKeyDown(event){const{key,altKey,ctrlKey,metaKey}=event;switch(1===event.key.length&&event.key!==keyboard_enum.A.SPACE&&!altKey&&!ctrlKey&&!metaKey&&(event.preventDefault(),state.isListOptionsOpen||dispatch(new SelectSimpleAction.OpenList),dispatch(new SelectSimpleAction.FocusOptionMatchingUserInput(key)),handlefocusOnTypeLetterDebounce()),key){case keyboard_enum.A.PAGE_UP:state.isListOptionsOpen&&(event.preventDefault(),dispatch(new SelectSimpleAction.PreviousOption(10)));break;case keyboard_enum.A.PAGE_DOWN:state.isListOptionsOpen&&(event.preventDefault(),dispatch(new SelectSimpleAction.NextOption(10)));break;case keyboard_enum.A.ARROW_UP:case keyboard_enum.A.IE_ARROW_UP:state.isListOptionsOpen?altKey?state.activeDescendant&&selectOption(state.activeDescendant):dispatch(new SelectSimpleAction.PreviousOption):dispatch(new SelectSimpleAction.OpenList),event.preventDefault();break;case keyboard_enum.A.ARROW_DOWN:case keyboard_enum.A.IE_ARROW_DOWN:state.isListOptionsOpen?dispatch(new SelectSimpleAction.NextOption):dispatch(new SelectSimpleAction.OpenList),event.preventDefault();break;case keyboard_enum.A.ESCAPE:case keyboard_enum.A.IE_ESCAPE:state.isListOptionsOpen&&event.preventDefault(),closeList();break;case keyboard_enum.A.SPACE:case keyboard_enum.A.ENTER:state.isListOptionsOpen?state.activeDescendant&&(selectOption(state.activeDescendant),event.preventDefault()):(cancelEvent(event),dispatch(new SelectSimpleAction.OpenList));break;case keyboard_enum.A.TAB:state.isListOptionsOpen&&state.activeDescendant&&selectOption(state.activeDescendant);break;case keyboard_enum.A.HOME:state.isListOptionsOpen||dispatch(new SelectSimpleAction.OpenList),dispatch(new SelectSimpleAction.FocusFirstOption),event.preventDefault();break;case keyboard_enum.A.END:state.isListOptionsOpen||dispatch(new SelectSimpleAction.OpenList),dispatch(new SelectSimpleAction.FocusLastOption),event.preventDefault()}}),[closeList,handlefocusOnTypeLetterDebounce,selectOption,state]);return(0,jsx_runtime.jsx)(SelectContext.C.Provider,{value:{activeDescendant:state.activeDescendant,isCurrentItemSelected,onOptionSelection:selectOption},children:(0,jsx_runtime.jsxs)("div",{className:Select_module.A.container,children:[(0,jsx_runtime.jsx)(Input.p,{ref:inputHiddenRef,tabIndex:-1,required,"aria-hidden":"true",name,onInvalid:onInvalidProps,value:optionSelectedValue}),(0,jsx_runtime.jsxs)("button",{type:"button",role:"combobox","aria-controls":listboxId,"aria-haspopup":"listbox","aria-expanded":state.isListOptionsOpen,"data-touched":touched,onClick:()=>dispatch(new SelectSimpleAction.ToggleList),"aria-activedescendant":state.activeDescendant,onKeyDown,onBlur,...rest,children:[placeholder,(0,jsx_runtime.jsx)(Icon.I,{name:"angle-down"})]}),(0,jsx_runtime.jsx)("ul",{role:"listbox",ref:listboxRef,"aria-label":optionsAriaLabel,id:listboxId,tabIndex:-1,hidden:!state.isListOptionsOpen,children})]})})}function cancelEvent(event){event.preventDefault(),event.stopPropagation()}function doNothing(){}SelectSimple.Option=SelectOption.O,SelectSimple.__docgenInfo={description:"",methods:[{name:"Option",docblock:null,modifiers:["static"],params:[{name:"{ className, value: valueProps, id: idProps, ...rest }: SelectOptionProps",optional:!1,type:{name:"intersection",raw:"Omit<React.ComponentPropsWithoutRef<'li'>, 'value'> & {\n\t// FIXME (GAFI 21-08-2024): Ça peut pas être optionnel ?\n\tvalue: { toString: () => string },\n}",elements:[{name:"Omit",elements:[{name:"ReactComponentPropsWithoutRef",raw:"React.ComponentPropsWithoutRef<'li'>",elements:[{name:"literal",value:"'li'"}]},{name:"literal",value:"'value'"}],raw:"Omit<React.ComponentPropsWithoutRef<'li'>, 'value'>"},{name:"signature",type:"object",raw:"{\n\t// FIXME (GAFI 21-08-2024): Ça peut pas être optionnel ?\n\tvalue: { toString: () => string },\n}",signature:{properties:[{key:"value",value:{name:"signature",type:"object",raw:"{ toString: () => string }",signature:{properties:[{key:"toString",value:{name:"signature",type:"function",raw:"() => string",signature:{arguments:[],return:{name:"string"}},required:!0}}]},required:!0}}]}}],alias:"SelectOptionProps"}}],returns:null}],displayName:"SelectSimple",props:{value:{required:!1,tsType:{name:"string"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: HTMLElement) => void",signature:{arguments:[{type:{name:"HTMLElement"},name:"value"}],return:{name:"void"}}},description:""},defaultValue:{required:!1,tsType:{name:"string"},description:""},onTouch:{required:!1,tsType:{name:"signature",type:"function",raw:"(touched: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"touched"}],return:{name:"void"}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},required:{required:!1,tsType:{name:"boolean"},description:""},onInvalid:{required:!1,tsType:{name:"FormEventHandler",elements:[{name:"HTMLInputElement"}],raw:"FormEventHandler<HTMLInputElement>"},description:""},optionsAriaLabel:{required:!0,tsType:{name:"string"},description:""}}}}}]);